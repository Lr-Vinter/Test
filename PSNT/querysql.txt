 
0) Temp

CREATE TEMP TABLE IF NOT EXISTS Variables (Name TEXT PRIMARY KEY, Value TEXT);
INSERT OR REPLACE INTO Variables VALUES ('VarStr', 'Val1');

SELECT Value
  FROM Variables
 WHERE Name = 'VarStr'


1) Join

select * from Posts
left join Followers ON Posts.OwnerID = Followers.TargetID AND followers.SubID = 2
left join Likes ON Posts.PostID = Likes.PostID
left join Followers as LikeFromTarget ON Likes.UserID = LikeFromTarget.TargetID AND LikeFromTarget.SubID = 2


2) Answer

select Posts.PostID, Posts.OwnerID, Message, Posts.CreatedAt from Posts
left join Followers ON Posts.OwnerID = Followers.TargetID AND followers.SubID = 2
left join Likes ON Posts.PostID = Likes.PostID
left join Followers as LikeFromTarget ON Likes.UserID = LikeFromTarget.TargetID AND LikeFromTarget.SubID = 2

where (followers.SubID = 2 OR LikeFromTarget.SubID = 2) AND Posts.CreatedAt > 2
order by Posts.CreatedAt 
limit 20


3) +likes

WITH Answer AS 
(
    select Posts.PostID, Posts.ObjectID, Posts.OwnerID, Message, Posts.CreatedAt from Posts
        left join Followers 
            ON Posts.OwnerID = Followers.TargetID AND followers.SubID = 2

        left join Likes 
            ON Posts.ObjectID = Likes.ObjectID

        left join Followers as LikeFromTarget 
            ON Likes.UserID = LikeFromTarget.TargetID AND LikeFromTarget.SubID = 2

    where (followers.SubID = 2 OR LikeFromTarget.SubID = 2) AND Posts.CreatedAt > 2

    order by Posts.CreatedAt 
    limit 20
)

select  Answer.PostID, Answer.OwnerID, Answer.Message, Answer.CreatedAt, 
        count(Likes.ObjectID) as LikeNumber from Answer
            left join Likes ON Answer.ObjectID = Likes.ObjectID

group by Answer.ObjectID
order by Answer.CreatedAt


4) Comments(can be better x10)

WITH Answer AS 
(
    select Posts.PostID from Posts
        left join Followers 
            ON Posts.OwnerID = Followers.TargetID AND followers.SubID = 2 AND Posts.PostID = 1
)
select Comments.CommentID, Comments.OwnerID, Comments.Message, Comments.CreatedAt, count(Likes.ObjectID) as LikeNumber from Answer 
    join Comments 
        ON Comments.PostID = Answer.PostID
    left join Likes 
        ON Comments.ObjectID = Likes.ObjectID
group by Comments.ObjectID



Posts
-
ObjectID int FK >- MessageObjects.ObjectID
PostID int PK
OwnerID int FK >- Users.UserID
Message string
CreatedAt int 

Users
-
UserID int PK
Hashname string
Firstname string
Lastname string

Followers 
-
FollowerID int PK
SubID int FK >- Users.UserID
TargetID int FK >- Users.UserID
CreatedAt int

SeenPosts
-
SeenID int PK
PostID int FK >- Posts.PostID
FollowerID int FK >- Followers.FollowerID
SeenAt string

MessageObjects
-
ObjectID int PK
Type string

Likes 
-
LikedID int PK
ObjectID int FK >- MessageObjects.ObjectID
UserID int FK >- Users.UserID

Comments
-
ObjectID int FK >- MessageObjects.ObjectID
CommentID int PK
PostID int FK >- Posts.PostID
OwnerID int FK >- Users.UserID
Message string
CreatedAt int 

































/// схема
Posts
-
ObjectID int FK >- MessageObjects.ObjectID
PostID int PK
OwnerID int FK >- Users.UserID
Message string
CreatedAt int 

Users
-
UserID int PK
Hashname string
Firstname string
Lastname string

Followers 
-
FollowerID int PK
SubID int FK >- Users.UserID
TargetID int FK >- Users.UserID
CreatedAt int

SeenPosts
-
SeenID int PK
PostID int FK >- Posts.PostID
FollowerID int FK >- Followers.FollowerID
SeenAt string

MessageObjects
-
ObjectID int PK

Likes 
-
LikedID int PK
ObjectID int FK >- MessageObjects.ObjectID
UserID int FK >- Users.UserID

Comments
-
ObjectID int FK >- MessageObjects.ObjectID
CommentID int PK
PostID int FK >- Posts.PostID
OwnerID int FK >- Users.UserID
Message string
CreatedAt int 